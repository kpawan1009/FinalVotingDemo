import json
from web3 import Web3

ganache_url = "HTTP://127.0.0.1:7545"
web3 = Web3(Web3.HTTPProvider(ganache_url))

web3.eth.defaultAccount=web3.eth.accounts[0]
print(web3.isConnected())
abi=json.loads('[{"inputs":[{"internalType":"string","name":"uuid","type":"string"}],"name":"List","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"Manager","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"uuid","type":"string"},{"internalType":"uint256","name":"p_no","type":"uint256"}],"name":"Vote","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"Winner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"c_name","type":"string"},{"internalType":"uint256","name":"age","type":"uint256"},{"internalType":"uint256","name":"p_no","type":"uint256"}],"name":"addCandidate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"v_name","type":"string"},{"internalType":"uint256","name":"age","type":"uint256"},{"internalType":"string","name":"pannumber","type":"string"},{"internalType":"string","name":"uuid","type":"string"}],"name":"addVoter","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"arr","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"candidates","outputs":[{"internalType":"string","name":"c_name","type":"string"},{"internalType":"uint256","name":"age","type":"uint256"},{"internalType":"uint256","name":"p_no","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"manager","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"voters","outputs":[{"internalType":"string","name":"v_name","type":"string"},{"internalType":"uint256","name":"age","type":"uint256"},{"internalType":"string","name":"pannumber","type":"string"},{"internalType":"string","name":"uuid","type":"string"},{"internalType":"uint256","name":"ticket","type":"uint256"},{"internalType":"bool","name":"voted","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"x","outputs":[],"stateMutability":"nonpayable","type":"function"}]')

bytecode="608060405234801561001057600080fd5b50611124806100206000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c806376fc96cb1161007157806376fc96cb1461015757806378357e53146101735780639c63d42e1461017d578063b2b98ed214610199578063c5539cc2146101b7578063cba40468146101e9576100a9565b80630c55699c146100ae5780631970e446146100b8578063481c6a75146100d457806353fa2e64146100f257806371e5ee5f14610127575b600080fd5b6100b6610219565b005b6100d260048036038101906100cd9190610b97565b610256565b005b6100dc6102c8565b6040516100e99190610ce1565b60405180910390f35b61010c60048036038101906101079190610a37565b6102ec565b60405161011e96959493929190610d1e565b60405180910390f35b610141600480360381019061013c9190610c06565b6104e3565b60405161014e9190610dd2565b60405180910390f35b610171600480360381019061016c9190610adc565b6104fe565b005b61017b6105ef565b005b61019760048036038101906101929190610a80565b610631565b005b6101a1610730565b6040516101ae9190610dd2565b60405180910390f35b6101d160048036038101906101cc9190610a37565b610794565b6040516101e093929190610d94565b60405180910390f35b61020360048036038101906101fe9190610a37565b61085c565b6040516102109190610cfc565b60405180910390f35b60005b60198110156102535760006003826019811061023b5761023a611054565b5b0181905550808061024b90610fad565b91505061021c565b50565b6040518060600160405280848152602001838152602001828152506001846040516102819190610cca565b908152602001604051809103902060008201518160000190805190602001906102ab92919061090f565b506020820151816001015560408201518160020155905050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60028180516020810182018051848252602083016020850120818352809550505050505060009150905080600001805461032590610f4a565b80601f016020809104026020016040519081016040528092919081815260200182805461035190610f4a565b801561039e5780601f106103735761010080835404028352916020019161039e565b820191906000526020600020905b81548152906001019060200180831161038157829003601f168201915b5050505050908060010154908060020180546103b990610f4a565b80601f01602080910402602001604051908101604052809291908181526020018280546103e590610f4a565b80156104325780601f1061040757610100808354040283529160200191610432565b820191906000526020600020905b81548152906001019060200180831161041557829003601f168201915b50505050509080600301805461044790610f4a565b80601f016020809104026020016040519081016040528092919081815260200182805461047390610f4a565b80156104c05780601f10610495576101008083540402835291602001916104c0565b820191906000526020600020905b8154815290600101906020018083116104a357829003601f168201915b5050505050908060040154908060050160009054906101000a900460ff16905086565b600381601981106104f357600080fd5b016000915090505481565b601283101561050c57600080fd5b6040518060c00160405280858152602001848152602001838152602001828152602001600181526020016000151581525060028260405161054d9190610cca565b9081526020016040518091039020600082015181600001908051906020019061057792919061090f565b5060208201518160010155604082015181600201908051906020019061059e92919061090f565b5060608201518160030190805190602001906105bb92919061090f565b506080820151816004015560a08201518160050160006101000a81548160ff02191690831515021790555090505050505050565b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550565b600015156002836040516106459190610cca565b908152602001604051809103902060050160009054906101000a900460ff1615151461067057600080fd5b60016002836040516106829190610cca565b9081526020016040518091039020600401541461069e57600080fd5b6001600382601981106106b4576106b3611054565b5b0160008282546106c49190610e6a565b9250508190555060016002836040516106dd9190610cca565b908152602001604051809103902060050160006101000a81548160ff02191690831515021790555060006002836040516107179190610cca565b9081526020016040518091039020600401819055505050565b6000806000905060005b601981101561078c576003826019811061075757610756611054565b5b01546003826019811061076d5761076c611054565b5b01541115610779578091505b808061078490610fad565b91505061073a565b819250505090565b6001818051602081018201805184825260208301602085012081835280955050505050506000915090508060000180546107cd90610f4a565b80601f01602080910402602001604051908101604052809291908181526020018280546107f990610f4a565b80156108465780601f1061081b57610100808354040283529160200191610846565b820191906000526020600020905b81548152906001019060200180831161082957829003601f168201915b5050505050908060010154908060020154905083565b606060028260405161086e9190610cca565b9081526020016040518091039020600001805461088a90610f4a565b80601f01602080910402602001604051908101604052809291908181526020018280546108b690610f4a565b80156109035780601f106108d857610100808354040283529160200191610903565b820191906000526020600020905b8154815290600101906020018083116108e657829003601f168201915b50505050509050919050565b82805461091b90610f4a565b90600052602060002090601f01602090048101928261093d5760008555610984565b82601f1061095657805160ff1916838001178555610984565b82800160010185558215610984579182015b82811115610983578251825591602001919060010190610968565b5b5090506109919190610995565b5090565b5b808211156109ae576000816000905550600101610996565b5090565b60006109c56109c084610e12565b610ded565b9050828152602081018484840111156109e1576109e06110b7565b5b6109ec848285610f08565b509392505050565b600082601f830112610a0957610a086110b2565b5b8135610a198482602086016109b2565b91505092915050565b600081359050610a31816110d7565b92915050565b600060208284031215610a4d57610a4c6110c1565b5b600082013567ffffffffffffffff811115610a6b57610a6a6110bc565b5b610a77848285016109f4565b91505092915050565b60008060408385031215610a9757610a966110c1565b5b600083013567ffffffffffffffff811115610ab557610ab46110bc565b5b610ac1858286016109f4565b9250506020610ad285828601610a22565b9150509250929050565b60008060008060808587031215610af657610af56110c1565b5b600085013567ffffffffffffffff811115610b1457610b136110bc565b5b610b20878288016109f4565b9450506020610b3187828801610a22565b935050604085013567ffffffffffffffff811115610b5257610b516110bc565b5b610b5e878288016109f4565b925050606085013567ffffffffffffffff811115610b7f57610b7e6110bc565b5b610b8b878288016109f4565b91505092959194509250565b600080600060608486031215610bb057610baf6110c1565b5b600084013567ffffffffffffffff811115610bce57610bcd6110bc565b5b610bda868287016109f4565b9350506020610beb86828701610a22565b9250506040610bfc86828701610a22565b9150509250925092565b600060208284031215610c1c57610c1b6110c1565b5b6000610c2a84828501610a22565b91505092915050565b610c3c81610ec0565b82525050565b610c4b81610ed2565b82525050565b6000610c5c82610e43565b610c668185610e4e565b9350610c76818560208601610f17565b610c7f816110c6565b840191505092915050565b6000610c9582610e43565b610c9f8185610e5f565b9350610caf818560208601610f17565b80840191505092915050565b610cc481610efe565b82525050565b6000610cd68284610c8a565b915081905092915050565b6000602082019050610cf66000830184610c33565b92915050565b60006020820190508181036000830152610d168184610c51565b905092915050565b600060c0820190508181036000830152610d388189610c51565b9050610d476020830188610cbb565b8181036040830152610d598187610c51565b90508181036060830152610d6d8186610c51565b9050610d7c6080830185610cbb565b610d8960a0830184610c42565b979650505050505050565b60006060820190508181036000830152610dae8186610c51565b9050610dbd6020830185610cbb565b610dca6040830184610cbb565b949350505050565b6000602082019050610de76000830184610cbb565b92915050565b6000610df7610e08565b9050610e038282610f7c565b919050565b6000604051905090565b600067ffffffffffffffff821115610e2d57610e2c611083565b5b610e36826110c6565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b600081905092915050565b6000610e7582610efe565b9150610e8083610efe565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115610eb557610eb4610ff6565b5b828201905092915050565b6000610ecb82610ede565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015610f35578082015181840152602081019050610f1a565b83811115610f44576000848401525b50505050565b60006002820490506001821680610f6257607f821691505b60208210811415610f7657610f75611025565b5b50919050565b610f85826110c6565b810181811067ffffffffffffffff82111715610fa457610fa3611083565b5b80604052505050565b6000610fb882610efe565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415610feb57610fea610ff6565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b6110e081610efe565b81146110eb57600080fd5b5056fea26469706673582212203b84eaf216ae5f683dc0d024387a7a7166f6c3398a2d46d38da5d9476256c2d664736f6c63430008070033"

Manager = web3.eth.contract(abi=abi,bytecode=bytecode)
# address = web3.toChecksumAddress("0xA15893D5Fd4F8c9eE31BAe37738b98e3D33918E0")

# contract = web3.eth.contract(address=address, abi=abi)
# x = contract.functions.greet().call()
tx_hash=Manager.constructor().transact()
print(tx_hash)

tx_receipt = web3.eth.waitForTransactionReceipt(tx_hash)

contract=web3.eth.contract(
    address=tx_receipt.contractAddress,
    abi=abi
)

# print(contract.functions.greet().call())

# tx_hash=contract.functions.setGreeting("Heeeeeelllllllloooooooooo!!").transact()
# tx_hash=contract.functions.addCandidate("Vansh",33,1).transact()
# tx_hash=contract.functions.addCandidate("ansh",43,2).transact()
# tx_hash=contract.functions.addVoter("Vinayak",33).transact()
# tx_hash=contract.functions.addVoter("sak",53).transact()

# contract.functions.Vote("Vinayak",2).transact()
# contract.functions.Vote("sak",2).transact()
# print(contract.functions.Winner().call())

def vote(name,age,pan_no,uuid):
    tx_hash = contract.functions.addVoter(name,age,pan_no,uuid).transact()
    # tx_receipt = web3.eth.waitForTransactionReceipt(tx_hash)
    print(contract.functions.List(uuid).call())
    print(uuid)
# tx_receipt = web3.eth.waitForTransactionReceipt(tx_hash)
# print(contract.functions.greet().call())
def reset():
    contract.functions.x().transact()



def Voting1(uuid):
    tx_hash=contract.functions.Vote(uuid,1).transact()
    print(tx_hash)
    print("111111111")
    print("111111111")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_******")
    print("_____*****")
    print("_____")
    print("_____")
    print("_____")

def Voting2(uuid):
    tx_hash=contract.functions.Vote(uuid,2).transact()
    print("22222222")
    print("22222222")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_____")
    print("_____")
    print("_____")
    print("_____")
    print("_____")
    print("_____")

def Voting3(uuid):
    tx_hash=contract.functions.Vote(uuid,3).transact()
    print("3333333")
    print("3333333")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_____")
    print("_____")
    print("_____")
    print("_____")
    print("_____")
    print("_____")

def abcd():
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_______")
    print("_____")
    print("_____")
    print("_____")
    # print(contract.functions.Winner().call())
    print("_____")
    print("_____")
    print("_____")

def winner():
    print("The Winner of Palghar is as follows")
    return contract.functions.Winner().call()

# reset()